# 第 14 章: アクセスの制御と監視

- [アクセス制御モデルの比較](#comparing-access-control-models) 
  - [権限、権利、特権の比較](#comparing-permissions-rights-and-privileges) 
  - [認可メカニズムの理解](#understanding-authorization-mechanisms) 
  - [セキュリティポリシーによる要件の定義](#defining-requirements-with-a-security-policy) 
  - [アクセス制御モデルの紹介](#introducing-access-control-models) 
  - [任意アクセス制御](#discretionary-access-control) 
  - [非任意アクセス制御](#nondiscretionary-access-controls) 
- [認証システムの実装](#implementing-authentication-systems) 
  - [インターネットでの SSO の実装](#implementing-sso-on-the-internet) 
  - [内部ネットワークでの SSO の実装](#implementing-sso-on-internal-networks) 
- [ゼロトラスト アクセス ポリシーの適用](#zero-trust-access-policy-enforcement) 
- [アクセス制御攻撃について](#understanding-access-control-attacks) 
  - [リスク要素](#risk-elements) 
  - [一般的なアクセス制御攻撃](#common-access-control-attacks) 
  - [コア保護方法](#core-protection-methods) 
- [まとめ](#summary) 

## アクセス制御モデルの比較

### アクセス許可、権利、特権の比較
| 用語 | 制御対象 | 一般的な例 | 試験のヒント | 
|------|------------------|-----------------|----------| 
| **アクセス許可** 🔑 | **オブジェクト** に対するアクション |ファイルの*読み取り*、*書き込み*、*実行* | **「ファイル中心」** の機能について考える | 
| **権限** 🛠️ | システム レベルの **アクション** | *システム時刻の変更*、*バックアップの復元* | 多くの場合、**OS ロール** に関連付けられている | 
| **特権** 🎖️ | 許可 **と** 権利の**組み合わせ** | 完全な **管理者** アクセス | 「**昇格された**」権限を忘れない | 

*重要なポイント*: 特権 ⊇ 権利 ⊇ 許可 - 上位の用語が下位の用語を包含します。

### 承認メカニズムの理解
| メカニズム | 目的 | CISSP のまとめ | 
|-----------|---------|---------------| 
| **暗黙の拒否** | 明示的に許可されない限り、既定でブロック | 「次の場合を除き、すべて拒否...」が最も安全なルールです | 
| **アクセス制御マトリックス** |中央テーブル マッピング **サブジェクト ↔ オブジェクト** | ACL の背後にある概念モデル | 
| **機能リスト** | **サブジェクトに焦点を当てた** 許可されたオブジェクトのリスト | 分散型。「トークン」と考えてください | 
| **制約付きインターフェイス** | サブジェクトが使用できない UI 要素を非表示/無効化 | *最小権限* を視覚的に適用 | 
| **コンテンツ依存制御** | **フィールド/コンテンツ** に基づいてデータをフィルター処理 | 例: PII をマスクする DB **ビュー** |
| **コンテキスト依存制御** | 特定の**ワークフロー**または**時間**の後にのみアクセスを許可 | ショッピングカートのチェックアウト、時間帯ルール | 
| **知っておくべきこと** | データ アクセスを仕事関連の情報に制限 | 多くの場合、MAC ラベルと組み合わせて使用されます | 
| **最小権限** | 職務を遂行するために**最小限の**権限を付与します | 権限の拡大を防止 | 
| **職務の分離** | 機密性の高いタスクを 2 人以上で分割します | 詐欺/エラーを軽減します | 

### セキュリティ ポリシーによる要件の定義
* **セキュリティ ポリシー** は、**何** を保護する必要があるか、および **どの程度** を保護するかを定義する上級管理者による高レベルの指令です。   
* **標準 (対象)**、**手順 (方法)**、および **ガイドライン (ベスト プラクティス)** の作成をガイドします。   
* アクセス制御の場合、ポリシーには、**最小権限**、**知る必要がある**、および**職務の分離**などの原則を明記する必要があります。実装の詳細は、下位レベルのドキュメントにあります。

### アクセス制御モデルの紹介
| モデル | コアアイデア | 長所 | 短所 | 一般的な環境 | 
|-------|------------|------------|------------|---------------------| 
| **任意 (DAC)** | **所有者** がオブジェクトにアクセスするユーザーを決定 | 柔軟、委任が簡単 | 内部者の誤った構成の影響を受けやすい | Windows **NTFS** ACL | 
| **ロール ベース (RBAC)** | **ジョブ ロール/グループ** に関連付けられた権限 | 管理を簡素化、権限クリープを抑制 | ロールを最新の状態に保つ必要があります | エンタープライズ アプリ、AD グループ | 
| **ルール ベース** |グローバル **if-then ルール** | 一貫性があり、監査が簡単 | 粒度が粗い | ファイアウォール、ルーター | 
| **属性ベース (ABAC)** | ポリシーは **複数の属性** (ユーザー、デバイス、アクション、コンテキスト) を評価 | 非常に粒度が高く、動的 | 設計が複雑 | SDN、クラウド IAM | 
| **必須 (MAC)** | サブジェクトとオブジェクトの **ラベル**。クリアランスが分類を支配する必要があります | 強力な機密性 | 厳格。管理オーバーヘッド | 軍事、政府 | 
| **リスクベース** | リアルタイムのリスク スコアリングが意思決定を促進 | 適応型。ML を活用 | まだ進化中。不透明なロジック | ゼロ トラスト、適応型 MFA | 

### 任意アクセス制御
* **所有権中心** - オブジェクト作成者が ACL を制御します。   
* **ID ベースの ACL** を介して実装。所有者は権限を **委任** できます。   
* **柔軟** ですが、**権限の無秩序な拡散** と **脆弱な監査証跡** が発生しやすいです。   
* Windows のファイル権限は、従来の DAC です。   
* 試験の観点 🔍: **DAC ≠ RBAC** であることを理解しておいてください。DAC は、「作成したものは共有します」という意味です。

### 非裁量的アクセス制御
* **一元管理** されており、ユーザーは権限を自分で変更できません。   
* **RBAC、MAC、ルール ベース、ABAC、リスク ベース** モデルが含まれます。   
* 利点: **一貫性、監査の容易さ、ポリシーの適用**。  
* 欠点: データ所有者の**柔軟性が低い**。堅牢な管理が必要です。   

*覚えておいてください*：「非 DAC」は基本的に、**アクセスの決定が個々のリソース所有者に**委ねられていない**モデルを意味します。

## 認証システムの実装

### インターネットでの SSO の実装  

#### 拡張マークアップ言語 (XML)   
* **概要**: 組織がカスタムの自己記述型要素を使用してデータをタグ付けできるようにするメタ言語。   
* **重要である理由**: ほとんどの Web SSO プロトコル (SAML、SOAP、WS-Federation) は **XML ベース** であり、ベンダー間の相互運用性を実現しています。

#### セキュリティ アサーション マークアップ言語 (SAML) 🔑   
| 要素 | フローにおける役割 | 試験のキーワード | 
|---------|------------------|---------------| 
| **プリンシパル / ユーザー エージェント** | アクセスを開始するブラウザーまたはアプリ | 「エンドユーザー」 | 
| **サービス プロバイダー (SP)** | ターゲット サービスをホストします | 「証明書利用者」 | 
| **アイデンティティ プロバイダー (IdP)** | ユーザーを認証し、**アサーション** を発行します | 「アサーティング パーティ」 | 
| **アサーション タイプ** | *認証*、*属性*、*承認* | IdP によって署名された XML メッセージ | 

* SAML 2.0 = **Web ブラウザー SSO** の *XML 標準* (OASIS)。   
* **POST**/リダイレクト バインディングを使用し、**X.509** 署名された XML に依存します。   
* 強み: 完全な **AA** (認証と承認) ステートメント。異なる組織 (フェデレーション) 間で機能します。

#### OAuth 2.0 🔓   
* 認証ではなく、**承認** の **フレームワーク** (RFC 6749)。   
* **アクセス トークン** を発行して、クライアント アプリがユーザーに代わって API を呼び出すことを可能にします。認証情報は第三者と共有されることはありません。   
* フローの例: *承認コード*、*クライアント認証情報*、*デバイス コード*。   
* トークンはベアラー スタイルで、通常の有効期間は **数分から数時間** です。

#### OpenID Connect (OIDC) 🛰️   
* OAuth 2.0 上に **認証レイヤー** を追加します。   
* IdP は、ユーザーの ID とオプションのプロファイル要求を含む **ID トークン** と呼ばれる **JSON Web トークン (JWT)** を返します。   
* 「Google でログイン」などのソーシャル ログイン フローを有効にします。 

#### SAML、OAuth、および OIDC の比較  
| 機能 | SAML 2.0 | OAuth 2.0 | OpenID Connect | 
|---------|----------|-----------|----------------| 
| **主な目的** | 認証 + AuthZ | AuthZ のみ | 認証 + AuthZ | 
| **データ形式** | XML | JSON (HTTP) | JSON (JWT) | 
| **トークン タイプ** | XML アサーション | アクセス トークン | ID トークン (JWT) + アクセス トークン | 
| **一般的なユース ケース** | 組織間のエンタープライズ フェデレーション / SSO | モバイルおよび API アクセス委任 | ソーシャル ログイン、最新の Web/モバイル SSO | 
| **トランスポート** | ブラウザー リダイレクト/POST | RESTful API | RESTful API |
| **下位互換性** | 成熟しているが冗長 | 軽量、多くの許可 | OAuth 2.0 に依存 | 

> **試験のヒント**: 「OAuth = *承認*、OIDC = *OAuth + 認証*、SAML = XML ベースのレガシーフレンドリーなフェデレーション」と覚えておいてください。   

### 内部ネットワークでの SSO の実装  

#### AAA プロトコルの概要  
AAA = **認証**、**承認**、**アカウンティング**—ネットワーク アクセス制御の 3 本柱。

| プロトコル | トランスポート / ポート | 長所 | 制限事項 | 一般的な用途 | 
|---------|-----------------|------------|-------------|-------------| 
| **Kerberos** | UDP/TCP 88 | 相互認証、*チケット*、**SSO**;資格情報を暗号化 (AES) | KDC = 単一障害点、厳密な時刻同期 (±5 分) | Windows/AD ドメイン ログオン、Unix レルム | 
| **RADIUS** | UDP 1812/1813 (TLS → TCP 2083) | 広くサポートされている NAS/VPN、集中型 AAA | デフォルトではパスワードのみを暗号化、UDP = 配信保証なし | ISP ダイヤルイン、802.1X Wi-Fi、VPN コンセントレータ | 
| **TACACS+** | TCP 49 | AAA を分離、**全体** のペイロードを暗号化、コマンドごとの認証 | Cisco 中心の遺産、RADIUS よりも重い | デバイス管理 (ルータ/スイッチ)、高セキュリティ NAS | 

#### Kerberos   
* **キー配布センター (KDC)** の問題:   
  * **認証サービス (AS)** → ユーザーを検証し、**チケット交付チケット (TGT)** を提供します。   
  * **チケット保証サービス (TGS)** → TGT をリソースへの **サービス チケット** と交換します。   
* **チケット**: タイムスタンプ付きの暗号化された BLOB で ID を証明し、**リプレイ攻撃** を防ぎます。   
* **レルム**: 1 つの KDC の下にある管理ドメイン。信頼関係により、レルムをリンクしてドメイン間 SSO を行うことができます。   
* **プロセスの要約**: ログオン → TGT → サービスごとのチケット → クライアントとサーバー間の相互認証。

#### RADIUS   
* クライアント = **ネットワーク アクセス サーバー (NAS)**; サーバー = RADIUS。   
* ワークフロー: NAS が資格情報を転送 → RADIUS が検証 → **アクセス承認/拒否** と属性 (VLAN など) を返します。   
* **コールバック** または **場所ベース** のポリシーをサポートします。   
* アカウンティング レコード (開始、停止、使用状況) は、監査と課金に役立ちます。

#### TACACS+   
* 認証、承認、アカウンティングを **独立したデーモン** に分割し、柔軟な導入を実現します。   
* **フルパケット暗号化** (RADIUS とは異なります)。   
* 個々のデバイスレベルのコマンドを細かく承認できるため、ネットワーク機器の管理が容易になります。   
* 信頼性の高い **TCP** トランスポートにより、レコードの損失が削減されます。

### クイック リファレンス テーブル – インターネット SSO メカニズムと内部 SSO メカニズム

| 環境 | プロトコル | キー トークン | 主な利点 | 試験のヒント | 
|-------------|------------|------------|--------------|-----------|
| **インターネット / クラウド** | SAML、OAuth、OIDC | XML アサーション / JWT | パスワードを共有しないクロスドメイン フェデレーション | *SAML = XML、OAuth = トークン委任、OIDC = OAuth + ID* | 
| **エンタープライズ LAN / VPN** | Kerberos、RADIUS、TACACS+ | チケット / Access-Accept | 集中型 AAA および単一の認証情報セット | *Kerberos では同期されたクロックが必要、TACACS+ では完全なペイロードを暗号化* | 

## ゼロ トラスト アクセス ポリシーの適用  

### コア原則  
| 原則 | 主要なアイデア | CISSP の視点 | 
|-----------|----------|-------------| | 
**決して信頼せず、常に検証する** 🔍 | ネットワークの場所に基づく暗黙の信頼はありません。すべてのリクエストはリアルタイムで認証および承認されます。 |境界のみの「堀と城」を打ち破ります。 | 
| **継続的な評価** | ID、デバイスの姿勢、場所、時間、ワークロードの機密性、脅威インテリジェンスは **毎回** チェックされます。 | 動的でリスクに適応した制御。 | 
| **最小権限 / マイクロセグメンテーション** | ユーザーとワークロードは、*単一の*リソースに限定された最小限のアクセス権のみを取得します。 | 横方向の移動を阻止します。 | 

#### NIST ZTA 論理コンポーネント  
| コンポーネント | 機能 | テクノロジーの例 | 
|----------|--------------|----------------------| 
| **ポリシー エンジン** | 信頼アルゴリズムを実行し、*許可/拒否/取り消し*を決定 | ZTNA、SDP コントローラーの PDP ロジック | 
| **ポリシー管理者** | PE の決定を適用し、セッション認証情報/トークンを発行 | クラウド プロキシ、マイクロゲートウェイ | 
| **ポリシー適用ポイント (PEP)** |トラフィックを傍受し、PA を照会し、判定を適用します | ホスト エージェント + インライン ゲートウェイ | 
| **外部データ フィード** | コンテキスト (ID、ポスチャ、SIEM、脅威インテリジェンス) を提供 | IdP、MDM/UEM、EDR、TI フィード | 

> **試験のヒント**: PE + PA = **ポリシー決定ポイント (PDP)**; PEP = **ポリシー適用ポイント**。

## アクセス制御攻撃について  

### リスク要素  
| 用語 | 定義 | クイック ニーモニック | 
|------|------------|----------------| 
| **脅威** | 悪影響を与える可能性のあるイベント | “*アクターまたは行為*” | 
| **脆弱性** | 脅威によって悪用される可能性のある弱点 | “*ドアが開いたまま*” | 
| **リスク** | 脆弱性を悪用する脅威の可能性 × 影響 | “*何が問題になり、損害を与える可能性があるか*” | 

### 一般的なアクセス制御攻撃  

#### 権限昇格  
| タイプ | 方向 | 一般的な戦術 | 
|------|-----------|----------------| 
| **水平** | 同じ権限レベル → 別のアカウント | 侵害されたユーザーの認証情報をピア マシンに渡す | 
| **垂直** | 低 → 高権限 (例: 管理者) | 脆弱性の悪用 / トークンの不正使用 / Mimikatz | 

#### パスワードに焦点を当てた攻撃  
| 攻撃 | コア メソッド | 軽減スナップショット |
|--------|-------------|---------------------| 
| **辞書** | ハッシュを一般的な単語リストと比較 | 長いパスフレーズ、ソルト | 
| **ブルートフォース** | すべての組み合わせを試す | 長さ↑、文字セット↑、レート制限 | 
| **スプレー** | ロックアウトを回避するために、同じパスワードと多くのアカウントを比較 | MFA、*IP* によるロックアウト | 
| **クレデンシャル スタッフィング** | 多くのサイトでパスワード/ユーザー名のペアを再利用する | 一意のパスワード、侵害の監視 | 
| **誕生日 (衝突)** | 同じハッシュを持つ異なるパスワードを検索する | 衝突耐性ハッシュ (SHA-3) を使用する | 
| **レインボー テーブル** | 事前計算されたハッシュ検索 | ソルト + ペッパー、強力な KDF (Argon2/bcrypt) | 

#### ハッシュ / チケットの不正使用  
| テクニック | ターゲット |ツール | 
|-----------|--------|---------| 
| **Pass-the-Hash (PtH)** | NTLM ハッシュ → NTLM 認証 | Mimikatz、WCE | 
| **Overpass-the-Hash** | NTLM ハッシュ → Kerberos TGT | Rubeus | 
| **Pass-the-Ticket** | Kerberos TGT/TGS の挿入 | Rubeus、Mimikatz | 
| **Silver Ticket** | サービス アカウントの TGS を偽造 | Mimikatz | 
| **Golden Ticket** | KRBTGT ハッシュ → 任意の TGT を偽造 | Mimikatz | 

#### Kerberos 固有のローストとブルート  
攻撃 | 脆弱な点 | 目標 | 
|--------|---------------|------| 
| **AS-REP ロースト** |事前認証のないユーザー | オフラインで `AS-REP` 暗号文をクラック | 
| **Kerberoasting** | 弱いサービス アカウント キー | サービス アカウントを所有するための TGS ハッシュをクラック | 
| **kerbrute.py / Rubeus ブルート 攻撃** | ユーザー名の列挙 | オンラインでのユーザー/パスワードの検出 | 

#### ネットワークと ID の欺瞞  
* **スニファー / 盗聴**: Wireshark を使用してクリアテキストの認証情報をキャプチャします。   
* **なりすまし**: IP、メール、または発信者 ID を偽装して認証情報を収集するか、ACL をバイパスします。

### コア保護方法  
* 認証情報 DB を保存しているサーバーに対する **物理的および論理的アクセス制御**。   
* **強力なソルト & ペッパー ハッシュ**: Argon2、bcrypt、PBKDF2。   
* **あらゆる場所での MFA** — 単一要素の侵害を阻止します。   
* **アカウント ロックアウト + 異常検出** (クリップ レベル、地理的速度)。   
* **セキュア プロトコル** (HTTPS、SSH、TLS) と転送中の暗号化。   
* **サービスにパッチを適用して強化**。最小権限のサービス アカウントで実行します (`LocalSystem` は避けます)。   
* **Mimikatz 署名、異常なチケット リクエストをログに記録して監視** (SIEM、EDR)。   
* **ユーザー教育** に固有のパスフレーズ、フィッシングの認識を組み込みます。   

## 概要  

* ゼロ トラストは **暗黙の信頼を排除** し、PDP および PEP コンポーネントを介して継続的でコンテキストに富んだポリシー チェックを必要とします。  
* アクセス制御攻撃は、**権限昇格** (水平/垂直) や **パスワード/資格情報クラッキング** (辞書、ブルート、スプレー、レインボー) から、高度な **ハッシュ/チケット偽造** (PtH、ゴールデン チケット) や **ネットワーク スニッフィング/スプーフィング** まで多岐にわたります。   
* これらの脅威に対する **多層防御** では、強力な暗号化、MFA、厳格な監視、最小権限、ユーザー/管理者の衛生管理を活用します。

