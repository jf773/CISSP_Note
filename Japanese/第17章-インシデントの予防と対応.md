# 第17章 インシデントの予防と対応

- [インシデント管理の実施](#インシデント管理の実施)
  - [インシデントの定義](#インシデントの定義)
  - [インシデント管理手順](#インシデント管理手順)
- [検出と予防策の実施](#検出と予防策の実施)
  - [基本的な予防策](#基本的な予防策)
  - [攻撃を理解する](#攻撃を理解する)
  - [侵入検知および防止システム](#侵入検知および防止システム)
  - [具体的な予防措置](#具体的な予防措置)
- [ログ記録と監視](#ログ記録と監視)
  - [ログ記録テクニック](#ログ記録テクニック)
  - [モニタリングの役割](#モニタリングの役割)
  - [監視とチューニングのテクニック](#監視とチューニングのテクニック)
  - [ログ管理](#ログ管理)
  - [出力監視](#出力監視)
- [インシデント対応の自動化](#インシデント対応の自動化)
  - [SOARを理解する](#soarを理解する)
  - [機械学習とAIツール](#機械学習とaiツール)
  - [脅威インテリジェンス](#脅威インテリジェンス)
  - [SOAR、機械学習、AI、脅威フィードの交差点](#soar機械学習ai脅威フィードの交差点)
- [要約](#要約)

## インシデント管理の実施

### インシデントの定義
- **コアコンセプト**: **インシデント** とは、組織の資産の機密性、整合性、または可用性 (CIA) に *悪影響を与える* イベントです。  
  - CISSP のコンテキストでは、*インシデント* **≡** *コンピュータ セキュリティ インシデント*。🌐  
- **権威ある定義**  
  - **RFC 2350**:「コンピュータまたはネットワークのセキュリティの一部を危険にさらす有害なイベント。」  
  - **NIST SP 800-61**:「コンピューターセキュリティポリシー、許容使用ポリシー、または標準的なセキュリティプラクティスへの違反、または違反の差し迫った脅威。」  
- **文言が重要な理由**: 正式な定義は通常、セキュリティ ポリシーまたはインシデント対応計画に取り込まれ、*範囲*、*優先順位*、および*必須の報告*を規定します。

#### イベントとインシデント（試験的に重要な区別）
| 用語 | 説明 | 試験のヒント |
|------|--------------|------------|
| **イベント** | 観察可能な状態の変化 (ログオフ、リンクアップなど) は、無害である可能性があります。 | 「日常的な」ノイズであり、必ずしも IR に値するわけではありません。 |
| **セキュリティ イベント** | セキュリティに関連する可能性のあるイベント。 | *アラート* が発生しますが、トリアージが必要です。 |
| **コンピュータ セキュリティ インシデント** | CIA を危険にさらす、またはポリシーに違反するイベントが確認されました。 | 完全な IR ワークフローがトリガーされます。 |

### インシデント管理手順
CISSP試験では、**7つの**段階的なステップ（図17-1）が重視されます。**_D RMRRR L_**（*検出、対応、軽減、報告、復旧、修復、教訓*）を覚えておいてください。

| # | ステップ | 目的 | 主なアクションとヒント |
|---|------|---------|--------------------|
| 1 | **検出** 🔍 | 潜在的なインシデントを検出します。 | IDS/IPS アラート、SOC 監視、マルウェア対策ポップアップ、ユーザー レポート。 *誤検知トリアージ* はこのステップの一部です。 |
| 2 | **対応** 🚑 | IR チーム (CSIRT/CIRT) を起動し、調査を開始します。 | インシデントを検証し、プレイブックに従ってエスカレーションし、揮発性の証拠を保存します (感染したホストの電源をオフにしないでください)。 |
| 3 | **緩和策** 🛑 | 攻撃範囲を封じ込め/制限する。 | ホストを隔離し、インターフェースを無効化し、サブネットを分離する。隠れた監視によって攻撃者のプロファイリングを継続する可能性がある。 |
| 4 | **報告** 📝 | 組織内外の関係者に通知します。 | 必要に応じて、社内幹部、規制当局 (PII 法)、業界団体 (PCI-DSS など)、法執行機関 (FBI、インターポール) に通知します。 |
| 5 | **リカバリ** ♻️ | 通常の操作に復元します。 | OS を再構築し、バックアップからデータを復元し、ACL を検証し、パッチを再適用し、デフォルトのアカウントを無効にします。 |
| 6 | **修復** 🔄 | 根本原因を排除し、再発を防止します。 | 根本原因分析 ➜ パッチ、コード修正、新しい制御、アーキテクチャの変更。 |
| 7 | **学んだ教訓** 🎓 | 得られた知識を制度化します。 | 事後分析レポート、ランブック/ルールの更新、検出しきい値の改善、スタッフのトレーニング。 |

#### CISSPとNIST SP 800-61のマッピング
| CISSP 7 ステップ モデル | NIST 4 フェーズ モデル | 注記 |
|--------------------|--------------------|-------|
| 検出 | 検出と分析 | NIST は検証を同じフェーズに組み込みます。 |
| 対応 + 緩和 | 封じ込め、根絶、回復 | CISSP は封じ込め (緩和) と修復 (回復) を分割します。 |
| レポート | すべてのフェーズで*暗黙的* (特に検出と回復) | 規制レポートは複数のフェーズにわたります。 |
| 回復 | 封じ込め、根絶、回復 | |
| 修復 | 封じ込め、根絶、回復 | 根本原因の修正に重点を置きます。 |
| 学んだ教訓 | インシデント後の活動 | 継続的な改善フィードバック ループ。 |

> **試験のヒント**: CISSP では **7 ステップ モデル** が *明示的に* 参照されます。各ステップの順序と目的を理解しておいてください。

#### 救急隊員の必需品
- **トリアージ スキル** は、単純な停止と本物のインシデントを区別します。  
- **保管の連鎖** は最初の接触から始まります。つまり、*誰が*、*何を*、*いつ*、*どこで*、*どのように*したかを文書化します。  
- 決して**反撃**をしないでください⚔️—違法であり、ポリシーに反します。

#### 一般的な検出テクノロジー
| テクノロジー | 一般的なアラート | 強み | 弱み |
|------------|--------------|-----------|-----------|
| IDS/IPS | Syslog/SIEM イベント | リアルタイム ネットワーク可視性 | 誤検知、調整が必要 |
| EDR/XDR | エンドポイント コンソール ポップアップ | 詳細なホスト テレメトリ | リソースを大量に消費 |
| ログ分析 (SIEM) | 相関アラート | 複数ソースのデータを集約 | ルールの品質が重要 |
| ユーザーレポート | ヘルプデスクチケット | コンテキストに富んだ人間の直感 | エラー/省略が発生しやすい |

> 🚩 **注意**: すべてのアラートがインシデントであるとは限りません。ステップ 2 にエスカレーションする前に *確認* してください。

#### 証拠保存チェックリスト
- RAM/揮発性データをキャプチャするには、システムの**電源をオン**にしておきます。
- ディスク イメージング時に **書き込みブロッカー** を使用します。  
- 整合性を確保するために暗号化 **ハッシュ** (SHA-256) を生成します。  
- コピーを、署名されたログが付いた **改ざん防止** コンテナーに保存します。

### 試験の重要なポイント✅
- **インシデントとは何か**を理解し、それをイベントと区別できる必要があります。
- 7 つのステップの **順序と目的** は、よくテストされる記憶項目です。
- **法的/規制上の報告トリガー** (PII 違反、PCI-DSS、GDPR) を理解する。  
- **反撃が禁止されている**理由と、証拠を適切に処理する方法を説明できるように準備しておいてください。  

> 🌟 **記憶法**: **D**ogs **R**un **M**iles **R**eporting **R**ed **R**oses **L**ively  
> (検出 → 対応 → 緩和 → 報告 → 回復 → 修復 → 教訓の抽出)

## 検出と予防策の実施

### 基本的な予防策
**予防制御** は、望ましくないセキュリティ イベントが発生する前にそれを阻止しようとしますが、**検出制御** は、発生した *後* にそれを識別します。  
| コントロールの種類 | 一般的な例 | 目的 | CISSP ホットボタン 🔥 |
|--------------|------------------|---------|--------------------|
| **予防的** | 🔐 ロック、🔒 ファイアウォール、✋ 職務分離、🔁 ジョブローテーション、🛡️ IDS/IPS (ブロッキング モード)、✉️ セキュリティ意識向上トレーニング、✨ 暗号化、👤 生体認証 | 不正なアクティビティを *阻止* | 多くの「予防的」制御 (例: **IPS**) は **検出** アラートも生成できることを知る |
| **検出** | 🚨 モーション センサー、🎦 CCTV レビュー、📜 監査ログ、🪤 ハニーポット、🧑‍💼 監視、📝 違反レポート、IDS/IPS (アラート モード) | 発生後にイベントを *検出* | 強制休暇監査とハニーネットは、古典的な **検出** メカニズムです |

すべての組織が実行すべき基本的な手順:

1. **パッチ管理**  
   - ベンダーのパッチを速やかに適用します。これは *リスク管理* (ドメイン 2) に直接結びつきます。  
2. **不要なサービス/プロトコルを無効にする**  
   - *攻撃対象領域* が縮小されます（ポート数が少なくなり、悪用されるデーモンも少なくなります）🛠️  
3. **IDS/IPSを導入する**  
   - 悪意のあるトラフィックを検出し、必要に応じてブロックします。誤検知を最小限に抑えるように調整する必要があります。  
4. **最新のマルウェア対策を維持する**  
   - 署名 + 動作分析。アプリケーション ホワイトリストと組み合わせてさらに広範囲にカバーします。  
5. **ホストとネットワークのファイアウォールを使用する**  
   - デフォルトの拒否ルール、セグメント化されたゾーン、ポリシー違反のログとアラート。  
6. **構成/変更管理プロセスに従う**  
   - ベースライン、バージョン管理、ピアレビュー、ロールバック計画。  
7. **継続的なユーザー教育** 📚  
   - フィッシング シミュレーション、ソーシャル エンジニアリング ドリルは、依然として最も優れた ROI 制御の 1 つです。  

> 💡 **試験のヒント:** CISSP では、*最も効果的な最初のステップを 1 つ挙げることがよくあります。システムに **パッチを適用** しておくことが、通常、リストの一番上に挙げられます。

---

### 攻撃を理解する
セキュリティ専門家は、適切な制御を選択するために、敵対者が**どのように**動作するかを認識する必要があります。

#### ボットネット 🤖
- **定義:** C2 サーバー経由で **ボット ハーダー** によってリモート制御される、侵害されたホスト (**ボット/ゾンビ**) のネットワーク。  
- **用途:** DDoS、スパム、クレデンシャルスタッフィング、サービスとしての犯罪のレンタル。  
- **多層防御:** マルウェア対策、パッチ適用済みの OS/アプリ、出力フィルタリング、DNS シンクホール、ユーザー意識向上トレーニング。

#### サービス拒否 (DoS / DDoS / DRDoS)
| バリアント | メカニズム | 重要な CISSP ポイント | 一般的な緩和策 |
|---------|-----------|------------------|--------------------|
| **DoS** | 単一の攻撃者がフラッド攻撃または脆弱性を悪用 | **スプーフィング** されていない場合は簡単に追跡可能 | レート制限、リソース調整 |
| **DDoS** | *多数* のソース (多くの場合ボットネット) がターゲットを圧倒 | IP をブロックするのが困難; 膨大な量 | クラウド スクラビング、エニーキャスト CDN |
| **DRDoS** | *リフレクタ* を使用してトラフィックを増幅し、被害者に送り返す (DNS、NTP など) | 「間接的な」フラッド - 被害者の IP を偽装 | オープン リゾルバ、BCP 38 出力フィルタリングを無効にする |

##### SYNフラッド 🌊
- **悪用:** TCP ハンドシェイクを半分開いたままにして、キューを使い果たします。  
- **対策:** SYN クッキー、SYN-ACK タイムアウトの短縮、状態追跡ファイアウォール/IPS。

##### TCP リセット攻撃
- 偽造された **RST** を送信して永続的なセッション (例: BGP、長期間有効な DB 接続) を終了します。  
- 暗号化されたトンネル (TLS、IPsec) とシーケンス番号の検証で軽減します。

##### スマーフ / フラグル 🐟
| 攻撃 | プロトコル | 増幅方法 | 現代の関連性 |
|--------|----------|----------------------|------------------|
| スマーフ | ICMP (ping) | **エコー要求** の直接ブロードキャスト | RFC 2644 フィルタリングが有効な場合はまれ |
| Fraggle | UDP ポート 7/19 | ブロードキャスト エコー/チャージン | UDP ブロードキャストが無効の場合はブロックされます |

##### ピングフラッド
- 大量の ICMP エコー要求 (ボットネット DDoS として一般的)。  
- 解決策: ICMP のレート制限、異常ベースの IDS、ICMP エコーの一時ドロップ。

##### レガシー DoS 攻撃 🕰️ *試験のために名前を覚えておいてください*
- **Ping of Death** (サイズが大きすぎる ICMP)  
- **ティアドロップ** (重複する IP フラグメント)  
- **LAND / Banana** (被害者から自分自身への偽装SYN)  
> これらは、**入力検証とパッチ適用** がなぜ重要であるかを強調しています。

---

#### ゼロデイエクスプロイト 🚨
- **一般的な意味:** 脆弱性は **攻撃者のみ** に知られており、パッチは存在しません。  
- **その他の用途:**  
  1. ベンダーは認識していますが、パッチはリリースされていません。  
  2. パッチがリリースされたが、組織がそれを適用していない (「Exploit Wednesday」と呼ばれることもあります)。  
- **保護:** サービス、アプリケーションのホワイトリスト、ネットワークのセグメンテーション、ヒューリスティック IDS/IPS、インテリジェンス用のハニーポットを最小限に抑えます。

#### 中間者攻撃（パス上）
- **目標:** 2 つのエンドポイント間のトラフィックを傍受/変更します。  
- **手法:** ARP スプーフィング、不正な Wi-Fi AP、SSL/TLS ストリッピング、悪意のあるプロキシ。  
- **コントロール:** エンドツーエンドの暗号化 (証明書ピン留め付きの TLS 1.3)、セキュア DNS (DNSSEC、DoH)、VPN トンネル、相互認証。

| 攻撃タイプ | パッシブ vs アクティブ | 検出の難易度 | 一般的な制御 |
|-------------|------------------|------------------|----------------------|-----------------|
| スニッフィング | パッシブ | 高 | 転送中の暗号化 |
| **MiTM** | *アクティブ* (転送と変更) | 中程度 | 証明書ピンニング、VPN、HSTS |
| セッション ハイジャック | アクティブ (Cookie/ID の乗っ取り) | 中程度 | セキュア Cookie、MFA、キー再生成 |

#### 妨害行為（内部脅威）🛠️
- **動機:** 不満、復讐、強制。  
- **トリガー:** 解雇の差し迫り、不正の認識、イデオロギー的対立。  
- **安全対策:**  
  - 解雇時の即時特権剥奪 🔒  
  - 最小権限と職務の分離  
  - 集中的なログ監視とUEBA（ユーザー/エンティティの行動分析）  
  - 不満を軽減するための認識とオープンなコミュニケーションの文化

### クイックリファレンス ✏️
| 攻撃 / 問題 | CIA への主な影響 | 最善の第一線制御 |
|----------------|-------------------|-------------------------|
| ボットネット参加 | **C**/*I*/A | マルウェア対策、ユーザー トレーニングを更新 |
| SYN フラッド | *A* | SYN クッキー、IDS/IPS |
| ゼロデイ | C/I/A | 多層防御、パッチの俊敏性 |
| MiTM | **C** & **I** | 強力な暗号化、証明書ピンニング |
| インサイダーによる妨害行為 | C/I/**A** | アクセスの無効化、監視 |

> 🎯 **CISSP受験の際の注意点:** 試験では、攻撃を最も効果的に軽減できる*単一*の対策を問われることがよくあります。既知の脆弱性への**パッチ**、MiTM（中間者攻撃）への**暗号化**、ボットネット封じ込めへの**セグメンテーション**、そしてボリューム型攻撃への**レート制限**や**クラウドDDoSサービス**などが挙げられます。

## 侵入検知および防止システム

### 概念と用語
- **侵入検知システム (IDS)** 🕵️‍♂️: **リアルタイムで** イベント/ログを監視し、異常なアクティビティや悪意のあるアクティビティを検出します。  
- **侵入防止システム (IPS)** 🛡️: IDS が実行するすべての機能に加えて、トラフィックをブロックまたは停止する機能 (インラインである必要があります)。  
- **IDPS**: NIST SP 800-94 で使用される、両方をカバーする包括的な用語。  
- **主な目標**: **多層防御** アーキテクチャの一環として、侵入を *タイムリーかつ正確に* 検出し、**(オプションで) 中断します。これはファイアウォールの代わりになるものではありません。

### 検出アプローチ
| アプローチ | 別名 | 仕組み | 長所 | 短所 |
|----------|-------------|--------------|------------|------------|
| **知識ベース** 🔍 | シグネチャ/パターンマッチング | イベントを既知の攻撃パターンの DB と比較 | 誤検知率が低く、更新が速い | 未知/改変された攻撃に対する防御なし (誤検知率が高い) |
| **動作ベース** 📈 | 異常 / 統計 / ヒューリスティック | 「通常の」動作の *ベースライン* を構築し、逸脱をフラグ付け | *新しいまたは難読化された* 攻撃を検出し、時間の経過とともに学習します | 誤検知率が高く、ベースラインがドリフトするため、調整が必要です |

> 💡 **試験のヒント**: 署名 = 偽陽性が少なく、偽陰性が多くなります。動作 = その逆です。

#### 偽/真マトリックス  
- **真陽性**: 実際の攻撃が検出されました  
- **誤検知**: 攻撃なし、アラートがトリガーされる（迷惑）  
- **偽陰性**: 実際の攻撃、*見逃された* (危険)  
- **真陰性**: 攻撃なし、警告なし  

### 応答モード
| モード | 機能 | アクションの例 |
|------|--------------|-----------------|
| **パッシブ** | ログ + 通知のみ | SOC、SIEM ダッシュボードへのメール/SMS |
| **アクティブ** | 環境の変更 | ACL、TCP RST、隔離ホストの自動編集 |

> インラインに配置され、アクティブにブロックされている場合、デバイスは機能的には **IPS/NIPS** になります。

### デプロイメントモデル
| タイプ | モニター | 長所 | 短所 |
|------|----------|------|------|
| **HIDS** 🖥️ | 単一ホスト (ログ、プロセス) | ローカルのエクスプロイトを検出、詳細な可視性 | リソースを大量に消費、ネットワークを認識できず、改ざんされやすい |
| **NIDS** 🌐 | タップ/SPAN 経由のネットワーク トラフィック | 1 つのセンサーで多数のホストをカバー、ステルス性が高い | 暗号化されたトラフィックの盲点、ホストの侵害を確認できない |
| **アプリケーションベースの IDS** | 特定のアプリ間フロー | きめ細かなプロトコル認識 | 狭い範囲、複雑性 |

### 暗号化されたトラフィックの処理
- **TLS 復号化/SSL オフロード アプライアンス** は HTTPS を復号化し、クリアなトラフィックを IDPS に送信し、送信ストリームを再暗号化します。  
- 制限: ホスト暗号化ペイロード (TLS 以前) または APT カスタム暗号は不透明なままです。

### 侵入防止システム（IPS）のハイライト
- データ パスと **インライン** - ターゲットがパケットを認識する前にパケットをドロップできます。  
- 多くの場合、**次世代ファイアウォール (NGFW)** または統合 UTM アプライアンスとして実装されます。  
- トレンド: センサーをインラインで再配置して、従来の NIDS を NIPS に変換します。

---

## 具体的な予防策

### ハニーポットとハニーネット 🍯
| 用語 | 定義 | 目的 |
|------|------------|----------|
| **ハニーポット** | 意図的に脆弱性を仕込んだ単一のデコイ ホスト (多くの場合 VM) | 攻撃者の進路を逸らし、攻撃を遅らせ、攻撃を調査し、ゼロデイに関する情報を収集します |
| **Honeynet** | 2 つ以上の相互接続されたハニーポット | より完全な環境、より豊富なテレメトリをシミュレート |

- **疑似欠陥** を使用して攻撃者を誘惑します。*誘惑* であって *おとり* でない場合は合法です。  
- すぐに元に戻せるように VM のスナップショットを作成します。*VM エスケープ*を回避するために注意深く監視します。

### 警告バナー 📝
- デジタル「立ち入り禁止」標識: 活動が監視されていることをユーザーに通知し、ポリシーを遵守させます。  
- 起訴およびプライバシー通知の法的立場を強化します。

### マルウェア対策（エンドポイント保護）
- 署名 + ヒューリスティック エンジン。**1 日あたり** 複数回更新されます。  
- **階層化戦略**: セキュア電子メール ゲートウェイ ✉️、境界での NGFW/UTM 🌐、エンドポイント AV/EDR 🖥️。  
- ホストごとに 1 つの製品 (エンジンの競合を回避)、**最小権限** を適用し、継続的なユーザー意識向上トレーニングを実施します。

### 許可（ホワイトリスト）リストと拒否（ブラックリスト）リスト
| リスト タイプ | 実行されるもの | ユース ケース | 例 |
|-----------|-----------|----------|---------|
| **許可リスト** ✅ | 承認されたハッシュ/パスのみ | 高セキュリティ ホスト、キオスク、iOS モデル | ハッシュベースの AppLocker ルール |
| **拒否/ブロック リスト** 🚫 | 禁止されたアイテム以外のすべて | 既知の悪質なアプリをブロックする簡単な方法 | 会社のブロック リストにゲームを追加 |

> ホストは**許可リスト**または**拒否リストのいずれかを使用しますが、両方を同時に使用することはありません。

### ファイアウォール 🧱
| 世代 | コア機能 | 標準レイヤー | 追加機能 |
|------------|-----------------|---------------|----------------|
| 1 番目 (パケット フィルター) | 静的 ACL (IP、ポート、プロトコル) | L3/L4 | - |
| 2 番目 (アプリケーション / 回線) | アプリケーション ゲートウェイ / セッションでの検査 | L5/L7 | プロキシ機能 |
| 3 番目 (ステートフル インスペクション) | 接続の *状態* を追跡 | L3～L7 | 動的ルール |
| **NGFW / UTM** | ステートフル + IDPS + マルウェア フィルター + SSL 復号化を組み合わせる | L3–L7 | App-ID、ユーザー ID、サンドボックス |

- **Edge の推奨事項**:  
  - *ダイレクトブロードキャスト*をブロックする 🚫  
  - WAN インターフェース上の *プライベート IP ソース* をドロップします 🌐  
  - ping フラッドに対して必要に応じて **ICMP エコー** をレート制限またはブロックする  

- 特殊なファイアウォール: **WAF** は Web アプリ (SQLi、XSS) を保護し、**NGFW** はユーザー/アプリの認識を追加します。

### サンドボックス化 🧪
- **信頼されていない** コードを安全に実行するための VM/コンテナの分離。  
- AV ベンダー、開発者、およびブラウザ エンジンによって使用され、コードが悪意のある場合に横方向の感染をブロックします。

### サードパーティのセキュリティサービス
- SOC、侵入テスト、または DDoS スクラブを専門のプロバイダーにアウトソーシングします。  
- プロバイダーが規制上の義務 (例: **PCI DSS**) を満たしていることを確認する必要があります。アウトソーシングでは **説明責任** はアウトソーシングされません。

### クイックルックテーブル

#### IDS と IPS
| 機能 | IDS | IPS |
|---------|-----|-----|
| 配置 | アウトオブバンド | インライン |
| レイテンシへの影響 | なし | 処理遅延が追加されます |
| トラフィックをブロックできます | いいえ (事後アクティブを除く) | はい (リアルタイム) |
| 主な用途 | 警告/フォレンジック | 防止 + 警告 |

#### 予防管理チートシート
| 制御 | 攻撃の軽減 (プライマリ) | 試験のキーポイント |
|---------|----------------------------|----------------|
| ハニーポット | ゼロデイ偵察 | 誘惑は合法だが、おとり捜査は違法 |
| 警告バナー | 内部脅威の証拠 | 監視の同意を確立 |
| 許可リスト | 許可されていない/マルウェアアプリ | 明示的に許可されていないすべてのものをブロック |
| SSL 復号化による NGFW | 暗号化された C2、マルウェア | インライン復号化 → 検査 |
| サンドボックス | 不明な実行ファイル | コードを格納し、安全に監視 |

> 🔑 **CISSP の場合の注意**: 複数の回答が正しいと思われる場合は、*最も早い段階*で*根本原因*に対処する回答を選択します (例: 許可リスト > 不正なアプリを防ぐための AV 署名)。

## ログ記録と監視

### ログ記録テクニック
- **目的**: イベントが *誰が*、*何を*、*いつ*、*どこで*、そして場合によっては *どのように* 発生したかを記録し、説明責任、フォレンジック、コンプライアンスをサポートします。📝  
- **ログ記録と監査**  
  - *ログ記録* = イベントの記録。  
  - *監査* = それらの記録を検査すること (第 15 章を参照)。  

#### 一般的なログの種類
| ログの種類 | 一般的な内容 | CISSP にとってなぜ重要なのか |
|----------|-----------------|---------------------------|
| **セキュリティ** | ファイル/印刷アクセス、オブジェクトの削除、特権アクション | ユーザーの責任を証明し、IR をサポートします |
| **システム** | 起動/シャットダウン、サービスの開始/停止、ドライバー エラー | 改ざんを検出 (例: AV サービスの無効化) |
| **アプリケーション** | アプリ固有のイベント (例: DB テーブル クエリ) | ビジネス アプリの誤用を示します |
| **ファイアウォール** | 許可/ブロックされたフロー、送信元/送信先 IP:ポート | ルール セットを検証し、攻撃パスをトレースします |
| **プロキシ/Web** | アクセスした URL、ユーザー、帯域幅 | AUP を適用し、C2 ビーコンを検出します 🌐 |
| **変更管理** | 要求、承認、実装された変更 | ロールバック、DR、コンプライアンス証拠をサポート |

> **試験のヒント**: *特権アカウントのアクティビティ* は常に価値の高いログ データです。

#### ログデータの保護
- SIEM またはログ サーバーに**集中化**します (変更不可能なコピー)。  
- *書き込み* アクセスを制限し、可能な場合はログを **読み取り専用** に設定します。  
- 法的/規制上のニーズと保管コストのバランスをとるために、**保持と破棄**のスケジュールを定義します。  
- **NTP** を介してタイムスタンプを同期します。イベントの相関には一貫性が重要です。  
- **FIPS 200** 監査の最小要件に従います (ユーザー アクションを追跡し、監視/調査のために記録を保持します)。

### 監視の役割
- **監査証跡**  
  - システムおよびユーザー アクティビティの時系列記録。インシデントの *再構築* をサポートします。  
  - 受動的な抑止力（CCTV など）ですが、起訴には不可欠な証拠となります。⚖️  

| 利点領域 | 重要なポイント | CISSP の角度 |
|--------------|-----------|--------------|
| **説明責任** | アクションを認証済み ID にリンクし、ポリシーの遵守を促進します | 十分な注意/デューデリジェンスに必要 |
| **調査** | タイムラインを再構築し、責任を証明または反論し、IR プレイブックと統合します | 保管の連鎖、法的許容性 |
| **問題の特定** | ハードウェア障害、パフォーマンスの問題、ソフトウェアのバグを検出 | 攻撃と故障を区別 |
| **規制コンプライアンス** | SOX、HIPAA、GDPR では特定の監視プラクティスが要求されます | 制御の有効性を実証 |

- **監視のベストプラクティス**  
  - リアルタイムの相関関係とアラートには **SIEM** を使用します。  
  - アラートを調整してノイズ (誤検知) を最小限に抑えます。  
  - ダッシュボードとレポートを定期的に確認します。*監視なしのログ記録は無駄です*。  
  - スタッフをトレーニングする: 監視されていることを知っているスタッフは、ポリシーに違反する可能性が低くなります。🙂  

> 🔑 **CISSP の覚えておいてください**: 効果的なログ記録 + 注意深い監視 = 検出、説明責任、およびフォレンジック準備のバックボーン。

### 監視とチューニングのテクニック

> モニタリングは「今何が起こっているのか？」という問いに答えます。  
> チューニングの答え *「ノイズを最小限に抑えながら正しい信号を受信していますか？」*

| アクティビティ | 目標 | 主要 CISSP ポイント |
|----------|------|------------------|
| **継続的な監視** 🛰️ | ホスト、ネットワーク、クラウド全体のイベントをリアルタイムで可視化 | 迅速な検出を促進。多くの場合、フレームワーク（例：NIST RMF「CM」ファミリ）によって義務付けられています |
| **チューニング** ⚙️ | 誤検知/誤検出を減らし、アラートをリスクに合わせて調整 | IDS/IPS シグネチャ、SIEM ルール、クリッピング レベルを調整、反復プロセス |
| **ログ分析** | ログから傾向/異常を抽出 (手動または自動) | IR 事後分析に不可欠; ベースライン設定をサポート |
| **SIEM** | 一元管理、相関、保持、アラート | 機能: エージェント、相関エンジン、ルールベースおよび ML 分析、ダッシュボード |
| **Syslog (RFC 5424)** | 業界標準のイベント トランスポート、UDP/TCP 514 | 拡張機能 (syslog-ng、Rsyslog) により、マルチプラットフォームのログを SIEM に取り込みます |
| **サンプリング** | 大規模なログ セットの統計的または非統計的なデータ削減 | 統計的 = 誤差の範囲、非統計的 = クリッピングしきい値 |
| **クリッピング レベル** | 時間あたり N 回のイベントが発生した場合にのみアラートを生成 (例: 30 分あたり 5 回の不正ログオン) | アラート疲労を最小限に抑えます (チューニングの一部) |
| **その他のツール** | CCTV、キーロガー（通知付き）、フロー監視 | ログ中心のビューを補完し、物理的/内部者による制御をサポート |

> 💡 **試験のヒント**: 適切な *相関* + *チューニング* を備えた SIEM は、生のログを実用的なインテリジェンスに変換する最も強力な方法です。

---

### ログ管理

*ログ管理ライフサイクル*:

| フェーズ | タスク | ベストプラクティスのハイライト |
|-------|-------|--------------------------|
| **コレクション** | イベントを生成して転送します (エージェント、Syslog、Windows イベント転送) | 重要なシステム/特権アカウントで最初に有効にします |
| **送信** | SIEM への安全なチャネル (TLS、VPN) | 改ざん/スニッフィングを防止 |
| **ストレージ** | 中央 SIEM DB、WORM メディア、または安全なファイル共有 | 書き込み専用/追記専用、ディスク暗号化 |
| **保持** | ポリシー/規制に従って保持 (例: SOX = 7 年、PCI = 1 年) | 過剰保持 ↑ 電子情報開示コスト |
| **保護** | 権限の強化、ハッシュ、バックアップ、物理的なセキュリティ | 合法的な使用のために保管チェーンを維持 |
| **処理** | ロールオーバー/循環ログまたはアーカイブとパージ | ディスク一杯の DoS を防止し、データ破壊ポリシーに従う |

主なメカニズム:

* **ロールオーバー ログ** (循環) - 最大サイズに達すると最も古いイベントを上書きします。  
* **アーカイブ ログ** - 完全なログをファイルに自動保存し、新しいログを開始します (リスク: ドライブがいっぱいになります)。  
* **SIEM 集約** により、取り込まれて検証されたソースの削除が可能になります。  
* **時間同期** 信頼できるパブリックソースにルートされた内部 NTP 経由 → 一貫したフォレンジック。

### 出力監視

**定義**: 送信トラフィックを検査して、*不正な*または*機密性の高い*データ転送がないかどうかを確認します。これは、データの流出を発見するために重要です🚨。

| 脅威ベクトル | 監視/制御 | 仕組み |
|--------------|--------------------|--------------|
| **DLP** | 送信 SMTP、HTTP/S、FTP のコンテンツとコンテキスト分析 | 正規表現、フィンガープリント、透かし、ブロック/隔離 |
| **ステガノグラフィー** | ベースラインと送信メディアのハッシュ比較、フォレンジックツール | 不一致は隠されたペイロードを示唆、詳細な分析のためにエスカレーション |
| **透かし入りデータ** | クリアファイル内の企業透かしを検出 | SIEM/DLP ルールによりアラート/ブロックがトリガー |
| **暗号化されたエクスポート** | フロー分析を使用して、*ボリューム*、*宛先*、*異常なホスト*を監視 | 異常な大容量 TLS アップロードにフラグを立て、ユーザー コンテキストと相関関係を形成 |
| **ポリシーベースのファイアウォール/NGFW** | 承認されたプロトコル/ポートのみを許可、TLS インスペクション | シャドー IT トンネル、許可されていない VPN を阻止 |

実装のヒント:

1. ポリシーで許可されている場合は、**SSL 復号化** を使用して、**発信リンク**を IDS/IPS または NGFW にミラーリングします。  
2. **ベースラインの通常送信** (GB/日、送信先) → 逸脱時にアラートを発します📈。  
3. **DLP** と **エンドポイント コントロール** を組み合わせます (USB マス ストレージ、クリップボードの制限を無効にします)。  
4. 出力ルールをドメイン 2 で定義された *データ分類* スキーマに適合させます。

> 🔑 **CISSP の注意事項**: アウトバウンド監視はインバウンド フィルタリングと同じくらい重要です。データ損失は機密性、ブランド、コンプライアンスに悪影響を及ぼします。

## インシデント対応の自動化

### SOARを理解する
セキュリティ オーケストレーション、オートメーション、レスポンス (SOAR) プラットフォームは、アラート、データ、ワークフローを統合し、反復的なレスポンス アクションが人的遅延なしで実行されるようにします。

| 概念 | 意味 | CISSP ナゲット |
|---------|---------------|---------------|
| **プレイブック** | 検証と対応の手順を*定義*する、人間が読めるチェックリスト | 自動化が失敗した場合のバックアップとして機能します |
| **ランブック** | プレイブックを実装するマシン実行可能ワークフロー | ローコード/ノーコードまたは YAML で記述され、SIEM/IDPS によってトリガーされます |
| **オーケストレーション** | API を介して多くのツール (SIEM、EDR、チケット、ファイアウォール) を統合 | 回転椅子の疲労を軽減 |
| **自動化** | 事前承認されたアクション (例: ホストの分離、IP のブロック、PW のリセット) | MTTR (平均応答時間) を短縮 |
| **対応** | 証拠収集、通知、封じ込め、修復 | 保管チェーンを維持する必要があります 🔒 |

> 💡 **試験のヒント**: SOAR ≠ SIEM。SIEM は *検出して相関関係を分析* し、SOAR は *決定して対応* します。

### 機械学習とAIツール
| 用語 | 簡単な定義 | セキュリティの使用例 |
|------|-------------------|----------------------------|
| **機械学習 (ML)** | システムは *トレーニング データ* + フィードバックを使用して改善します | ベースライン駆動型異常 IDS、マルウェア ファミリ分類器 |
| **人工知能 (AI)** | より広い分野: 推論、判断、適応を行うシステム (ML サブセット) | 自律型 SOC アシスタント、自然言語トリアージ ボット |

主な違い:

1. **知識の開始** – ML はルール/データから始まります。AI はルールを自ら学習する場合があります。  
2. **適応ループ** – どちらもフィードバック (真陽性/偽陽性) に依存してモデルを改良します。  
3. **CISSP の観点** – ベンダーの「AI」の主張は、単に人間が作成したルールを備えた高度な ML である可能性があることを認識してください。

### 脅威インテリジェンス
**現在の攻撃者の TTP** を収集、拡充し、運用化します。

| レイヤー | 説明 | 一般的なソース |
|-------|--------------|-----------------|
| **戦略的** | 高レベルの傾向、国家の動機 | 政府 CERT アドバイザリ、ISAC ブリーフィング |
| **運用** | キャンペーンとアクターのプロファイル、キルチェーンの洞察 | ダークウェブの監視、APT レポート |
| **技術的** | ドメイン、IP、ハッシュ、YARA ルール | 商用 TI フィード、VirusTotal |
| **戦術的** | 制御のリアルタイム インジケーター (ブロックリスト) | STIX/TAXII がファイアウォール/IDPS にフィード |

知っておくべきフレームワーク:

- **ロッキード・マーティン サイバー キル チェーン** – 7 つの連続フェーズ (偵察 → アクション)。  
- **MITRE ATT&CK** – 技術と緩和策を備えた戦術のマトリックス (権限昇格、横方向の移動など)。

### SOAR、機械学習、AI、脅威フィードの交差点
- **脅威フィード ➜ SIEM 相関 ➜ SOAR ランブック**: フィードに悪意のある IP が表示される → SIEM が一致 → SOAR がファイアウォール ルールを自動ブロックし、チケットが開きます。  
- **ML 強化 SOAR**: モデルがアラートの重大度をランク付けし、それに応じてランブックが分岐します (高 = 自動分離、低 = アナリストのキュー)。  
- **AI アシスタンス**: チャット スタイルのエージェントがインシデントのタイムラインを要約したり、インシデント後のレポートの下書きを作成したりします ✍️。

> ⚠️ **リスク**: 過剰な自動化は *誤検知* に基づいて動作する可能性があります ➜ 影響の大きいアクションには常に手動承認ゲートを構築します。

## まとめ
- **SOAR** は、文書化された **プレイブック** を自動化された **ランブック** に変換し、さまざまなツールを調整して応答時間を大幅に短縮します。  
- **機械学習** は検出基準を微調整し、**AI** は独自にルールとコンテキストを合成することを目指します。  
- **脅威インテリジェンス** (戦略的 → 戦術的) は実用的な指標を提供し、フィードを SOAR に統合することで制御を最新の状態に維持します。  
- **SOAR + ML/AI + TI** を組み合わせると、フィードバックが豊富な自己更新型の防御ループが作成されますが、コーナーケースや法的説明責任については依然として人間による監視が必要です。✅
